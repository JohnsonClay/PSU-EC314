{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Internal Rate of Return\"\noutput: beamer_presentation\n---\n\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE)\noptions(scipen=999)\n\nAcc<-function(x){format(x,nsmall=2,digits=2,big.mark=',',scientific=FALSE)}\npgivena<-function(a,i,n){a*((1+i)^n -1)/(i*(1+i)^n)}\npgiveng<-function(g,i,n){g*( (1+i)^n -(i*n) -1  )/(i^2*(1+i)^n)}\nagivenp<-function(p,i,n){p*(i*(1+i)^n)/((1+i)^n -1)}\npgivengrow<-function(a1,g,i,n){a1*(1-(1+g)^n*(1+i)^(-n))/(i-g)}\n\n\nfgivena<-function(a,i,n){pgivena(a,i,n)*(1+i)^n}\nfgiveng<-function(g,i,n){pgiveng(g,i,n)*(1+i)^n}\n\n```\n\n## Goals\n\n+ Present a few ways of calculating internal rate of return with cautions.\n+ Explain why the IRR criteria is different for loans and investments.\n+ Explain the quirks of the exclusive choice procedure.\n\n\n## What is Internal Rate of Return?\n\nIt is an interest rate such that the present worth of an asset is zero.\n\n+ PW is with known $i$.  IRR has a known PW, zero, and you solve for $i$. \n+ It is \"an\" because multiple internal rates of return are fairly common.\n\n## The Problem\n\n$$PW = A_0 + \\frac{A_1}{(1+i)} + \\frac{A_2}{(1+i)^2} + \\dots +  \\frac{A_N}{(1+i)^N}$$\n\n+ Should look like a polynomial\n+ Internal rates of return are the roots of this polynomial\n+ You can have more than one root.\n\n## Example One Root\n$$PW = -10 + \\frac{15}{(1+i)^3}$$\n```{r, fig.height=5}\ncurve(-10 + 15/(1+x)^3, from = 0, to = 1)\ncurve(x*0, from = 0, to = 1, add = TRUE)\n```\n\nNote the single root at $\\left( \\frac{15}{10}     \\right)^{\\frac{1}{3}} -1 = `r (15/10)^(1/3) - 1`$\n\n## Easy Calculation\n\nSimple case is when you have a value for $A_0$ and then one value in another time period, $A_N$\n\n$$\\begin{split}PW = 0 &= A_0 + \\frac{A_N}{(1+i)^N}\\\\\n\\Rightarrow -A_0 &=\\frac{A_N}{(1+i)^N}\\\\\n\\Rightarrow i &= \\left(  \\frac{-A_N}{A_0} \\right)^{\\frac{1}{N}} -1\n\\end{split}$$\n\n## Multiple Roots\n\nDescartes' rule of signs:  The number of positive real roots is less than or equal to the number of sign changes in the coefficients of the polynomial.\n\nYear| A | B |\n----|---|---|\n0   | -10 | -10 |\n1   |10 |10  |\n2   |10  |-5 | \n\n+ A Has only one sign change and therefore at most one IRR, i.e., one positive real root.\n+ B has two sign changes and therefore *at most* two positive IRRs, i.e, two positive real roots.\n\n## Multiple IRRs\nThis has IRRs at 10%, 30% and 50%\n```{r , fig.height=5}\n\ncurve(-1000 + 3900/(1 + x) - 5030/(1 + x)^2 + 2145/(1 + x)^3, 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ This is -1000, 3900, -5030, 2145\n+ Note three  sign changes.\n\n## At Most ...\n\n\n```{r , fig.height=5}\n\ncurve(-1002 + 3900/(1 + x) - 5030/(1 + x)^2 + 2145/(1 + x)^3, 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ This is -100*2*, 3900, -5030, 2145\n+ Only one root.\n\n## Calculating IRR\n\n+ Your calculator will have:\n    + IRR function: Works but you need to give it a starting value if there is more than one root.\n    + solve: Which is symbolic algebra and is gimped and limits number of cash flows.\n    + nsolve: Similar to IRR with a starting value requirement.\n+ Spreadsheets\n    + IRR( range, [estimated_irr] )\n    + Numerical root finder that requires starting value if you have more than one root.\n\n## Try a few\n\n```{r}\nlibrary(polynom)\n\n\nOneIRR <-function(A){\n  polyform <- as.function(polynomial(A))\n  d <- uniroot(function(x) polyform(x), interval = c(0, 1))$root\n  (1-d)/d\n}\n\n#OneIRR(c(-10,0,0,15))\n\n```\n\n\nYear| A | B | C\n----|---|---|---\n0   | -10 | 10 |-10\n1   |0 |0  |7\n2   |15  |-15 |7 \n\n\n\n## How did you do?\n\n\nYear| A | B | C\n----|---|---|---\n0   | -10 | 10 |-10\n1   |0 |0  |7\n2   |15  |-15 |7 \nIRR|`r OneIRR(c(-10,0,15))`| `r OneIRR(c(10,0,-15))`| `r OneIRR(c(-10,7,7))`\n\n\n+ It should not be a shock that A and B give the same result.\n+ BTW I used a numerical solver for this.\n+ Lets look at shapes starting with A\n\n## Cost 10 Now and Gives 15 in time 2\n\n```{r , fig.height=5}\n\ncurve(-10 + 15/(1 + x)^2 , 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ PW is zero at `r OneIRR(c(-10,0,15))`.\n+ Is investment shaped, costs now and benefits later.\n+ If MARR is less than IRR, PW>0 and a good asset.\n+ If MARR is greater than IRR, PW<0 and not good.\n\n\n## Gives 10 Now and Costs 15 in time 2\n\n```{r , fig.height=5}\n\ncurve(10 - 15/(1 + x)^2 , 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ PW is zero at `r OneIRR(c(10,0,-15))`.\n+ Is loan shaped, benefits now and costs later.\n+ If MARR is less than IRR, PW>0 and a bad asset.\n+ If MARR is greater than IRR, PW<0 and good asset.\n\n\n## Summary Unconstrained Choice Criteria\n\n+ If the asset has a single root...\n    + and is an investment, buy if $IRR \\geq MARR$\n    + and is a loan, buy it if $MARR \\geq IRR$\n+ In words\n    + Buy assets with high returns.\n    + Take out loans with low rates.\n    \n## What if there is more than one IRR?\n\n```{r , fig.height=5}\n\ncurve(-1000 + 3900/(1 + x) - 5030/(1 + x)^2 + 2145/(1 + x)^3, 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ It depends on the client\n+ Often the clients that ask for IRR don't understand that there can be more than one root.\n+ Had a student with real problem that had 100 IRRs.\n+ One of my first consulting oopses was about IRR.\n\n## True Story\n\n+ Was presenting and asset had two roots.\n+ This guy, George, questioned my competence because he thought it wasn't possible.\n+ The Chief Economist taught me a more gentle way of treating fools...you lie.  \n\nA lie of omission, not commission.\n\n## An Approach\n\n+ Feel out your client.  If they get that there can be more than one IRR, tell them.\n+ If they don't\n    + Find out the range for the likely MARR.\n    + Only tell them the IRR that leads them to the correct decision and is  reasonably conservative.\n+ If they are a long-term client, you can introduce the idea later.\n    + Consulting is  a tough teaching gig.\n    + Just because everyone nods, doesn't mean they get it.  Lots off emperors new clothes effects.\n\n## Example: MARR<10\\%\n\n```{r , fig.height=5}\n\ncurve(-1000 + 3900/(1 + x) - 5030/(1 + x)^2 + 2145/(1 + x)^3, 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ Notice that the PW > 0 and they should buy it.\n+ Tell them 10%\n    + Smallest number that\n    + Leads them to correct conclusion, \"buy\",  because IRR>MARR\n    \n## Example: 30%>MARR>10\\%\n\n```{r , fig.height=5}\n\ncurve(-1000 + 3900/(1 + x) - 5030/(1 + x)^2 + 2145/(1 + x)^3, 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ Notice that the PW < 0 and they should NOT buy it.\n+ Tell them 10%\n    + Smallest number that\n    + Leads them to correct conclusion, \"Don't Buy\", because IRR<MARR    \n    \n    \n## Example: 50%>MARR>30\\%\n\n```{r , fig.height=5}\n\ncurve(-1000 + 3900/(1 + x) - 5030/(1 + x)^2 + 2145/(1 + x)^3, 0, .6, ylab = \"PW\", xlab=\"i\"  )\ncurve(0 * x, 0, .6, add = TRUE)\n```\n\n+ Notice that the PW > 0 and they should  buy it.\n+ Tell them 50%\n    + Smallest number that\n    + Leads them to correct conclusion, \"Buy\", because IRR>MARR    \n\n    \n## Exclusive Choice\n\n+ Unconstrained choice  IRR is pretty common.\n+ Exclusive choice is not\n    + Never saw it in the real world.\n    + Only on the  PE exam.\n+ Promise me you will never use this in the real world.\n\n## Promise Me\n\nI'm serious, never use this.\n\n## Exclusive Choice IRR\n\n+ Historical algorithm\n+ Great for when computation was expensive and decision making was cheap.\n+ Economized on computation.  You did it once.\n+ After you had that data you could play \"What-if\" with the MARR as long as you wanted.\n\n## Don't pick asset with largest IRR\n\nYear| A | B |\n----|---|---|\n0   | -1 | -1000 |\n1   |2 |1110  |\nIRR|`r 2/1 -1`| `r 1110/1000 -1`|\n\nA has the highest IRR but if MARR is moderate, you want B.\n\n## The Procedure\n\nThis procedure has a lot of caveats\n\n+ All assets are investments.\n+ All assets have a single IRR\n+ All incremental IRRs are unique\n+ Only $A_0<0$.  No costs after time zero.\n\n## Incremental IRR\n\n+ Incremental IRR is the internal rate of return of the difference between two cash flows.\n+ Often though of as the IRR of upgrading to another asset.\n+ Example:\n\nYear| A | B |B-A|\n----|---|---|---|\n0   | -1 | -1000 |-999|\n1   |2 |1110  |1108|\nIRR|   |   |`r 1108/999 -1`|\n\n$$IRR(B-A)\\neq IRR(B) - IRR(A)$$\n\n## Common Problem with Incremental IRRs\n\nYear| A | B |B-A|\n----|---|---|---|\n0   | -1 |-3|-2|\n1   |0    |6 | 6|\n2   |2   |  0 | -2  |\n\n+ Notice that both A and B have one sign change\n+ Notice that B-A has two sign changes.  \n    + Not two IRRs but the threat is there.\n    + This causes problems for the algorithm. \n\n\n## The Algorithm\n\n+ Order assets from smallest initial investment to largest.\n+ Eliminate all assets with IRR<MARR.\n+ Set asset with smallest initial investment as Best Candidate (BC)\n+ While assets remain:\n    + Set next asset as Challenger (C)\n    + If Incremental IRR $\\geq$ MARR, Eliminate BC and set C as BC.\n    + Else, Eliminate C.\n+ Remaining Asset is the best.\n\n## Commentary on the Algorithm\n+ Order assets from smallest initial investment to largest.\n    + Done so incremental IRRs are all interpreted as investments and you can use IRR>MARR as a test.\n+ Eliminate all assets with IRR<MARR.\n    + Assets that are not acceptable can't be the best.\n\n## Commentary (Con't)\n\n+ Set asset with smallest initial investment as Best Candidate (BC)\n+ While assets remain:\n    + Set next asset as Challenger (C)\n    \nThis initializes a loop and creates a series  of tournaments.\n    \n+ If Incremental IRR $\\geq$ MARR, Eliminate BC and set C as BC.\n+ Else, Eliminate C.\n\nThe uniqueness of IRRs and the ordering by initial investment, coupled with only allowing costs in period zero, allows the easy comparison.\n\n## Example with Computation of All Values\n\nYear| A | B |C  |\n----|---|---|---|\n0   | -1| -3|-7 |\n1   |0  |0  |0  | \n2   | 2  |  5 | 10  |\n\n+ Compute IRRs for all assets.\n+ Compute incremental IRRs for all pairs of assets.\n+ Use data to follow the algorithm\n\n## IRRs\n\n```{r}\nIRRA <- (2/1)^(1/2) - 1\nIRRB <- (5/3)^(1/2) - 1\nIRRC <- (10/7)^(1/2) - 1\n```\n\n\nYear| A | B |C  |\n----|---|---|---|\n0   | -1| -3|-7 |\n1   |0  |0  |0  | \n2   | 2  |  5 | 10  |\nIRR |`r IRRA`| `r IRRB`| `r IRRC`|\n\nRemember $IRR = \\left( \\frac{-A_N}{A_0} \\right)^ {\\frac{1}{N}} - 1$ when you only have values in time zero and one other time period.\n\n\nTry computing IRR(B-A) and IRR(C-A).\n\n \n## Incremental IRRs\n\n```{r}\nAB <- (3/2)^(1/2) - 1\nAC <- (8/6)^(1/2) - 1\nBC <- (5/4)^(1/2) - 1\n\n```\n\nYear| A | B |B-A  |\n----|---|---|---|\n0   | -1| -3| -2 |\n1   |0  |0  |0  | \n2   | 2  |  5 | 3  |\nIRR |`r IRRA`| `r IRRB`| `r AB`|\n\n\nYear| A | C |C-A  |\n----|---|---|---|\n0   | -1| -7|-6 |\n1   |0  |0  |0  | \n2   | 2  |  10 | 8  |\nIRR |`r IRRA`| `r IRRC`| `r AC`|\n\nTry IRR(C-B)\n\n## Incremental IRRs (Con't)\n\n\nYear| B | C |C-B  |\n----|---|---|---|\n0   | -3| -7|-4 |\n1   |0  |0  |0  | \n2   | 5  |  10 | 5  |\nIRR |`r IRRB`| `r IRRC`| `r BC`|\n\n\n## Summary of Data\n\nAsset | IRR     | A   | B     |   C   |\n----  |----     |---- |-----  |-----  |\nA     |`r IRRA` |     |`r AB` |`r AC` |\nB     |`r IRRB` |     |       |`r BC` |\nC     |`r IRRC` |     |       |       |\n\nThe other half of the incremental IRR matrix is often not given because it is symmetric.\n\nFind the best asset when the MARR is 15%.\n\n## MARR of 15%\n\nAsset | IRR     | A   | B     |   C   |\n----  |----     |---- |-----  |-----  |\nA     |`r IRRA` |     |`r AB` |`r AC` |\nB     |`r IRRB` |     |       |`r BC` |\nC     |`r IRRC` |     |       |       |\n\n+ Order assets as A, B ,C because initial costs are 1, 3, and 7 respectively.\n+ No assets have IRRs less than MARR\n+ A is BC and B is first challenger.\n    + IRR(B-A) = `r AB` > MARR, toss A and set B as BC.\n    + IRR(C-B) = `r BC` < MARR, toss C.\n\nB is the best asset at 15%.\n\n## Arrow Notation Explained\n\n![](ArrowDiagram.png)\n     \n\n     \n## Arrow Notation  MARR 15%\n\nAsset | IRR     | A   | B     |   C   |\n----  |----     |---- |-----  |-----  |\nA     |`r IRRA` |     |`r AB` |`r AC` |\nB     |`r IRRB` |     |       |`r BC` |\nC     |`r IRRC` |     |       |       |\n\n\n![](15Percent.png)\n\n\n## MARR of 20%\n\nAsset | IRR     | A   | B     |   C   |\n----  |----     |---- |-----  |-----  |\nA     |`r IRRA` |     |`r AB` |`r AC` |\nB     |`r IRRB` |     |       |`r BC` |\nC     |`r IRRC` |     |       |       |\n\n+ Order assets as A, B ,C because initial costs are 1, 3, and 7 respectively.\n+ Eliminate C since IRR(C) = `r IRRC`<MARR\n+ A is BC and B is first challenger.\n    + IRR(B-A) = `r AB` > MARR, toss A.\n\nB is the best asset at 20%.\n\n\n## Arrow Notation MARR 20%\n\n\nAsset | IRR     | A   | B     |   C   |\n----  |----     |---- |-----  |-----  |\nA     |`r IRRA` |     |`r AB` |`r AC` |\nB     |`r IRRB` |     |       |`r BC` |\nC     |`r IRRC` |     |       |       |\n\n\n![](20Percent.png)\n\n## Further Intuition on Why the Algorithm works.\n\n![](Setup.png)\n\n\n## Describe Assets\n\n\n![](theassets.png)\n\n\n## Eliminate Unacceptable\n\n\n![](lessthanmarr.png)\n\n\n## The Loop \n\n\n![](ac.png)\n\n\n## Loop (Cont)\n\n\n![](cd.png)\n\n\n\n## Loop (Cont)\n\n![](ce.png)\n\n\n\n## The Last Asset Standing\n\n![](cf.png)\n\n\n## More Examples\n\n+ Examples are randomly generated.\n+ If you want, download or clone, and knit.  \n+ Correct answer and initial ordering are produced but not the steps or arrow diagrams.\n\n\n## Larger Example\n\n```{r, include=FALSE}\n## Helper Functions\n\n\n## DATA GENERATION\n\n#Generate 6 Random IRR and H_0 with a regression model so that there is an inverse relationship.\n\nAO <- sample(1:30, 6)\nIRR <- (40 + (-1) * AO + rnorm( 6, sd = 3))/100\nRawIRR <- IRR\nIRR <- IRR * 100\n\n#\n#\n#Generate random matrix 6x6 upper trianglular symetric materic with similar range. The incrementals can be lower than the IRRs but not higher.  The 5% difference may have to be tuned in the future.\n\nIRROverRun <- .05\n\nIncIRR <- matrix(runif(6*6, min = max(.01, min(RawIRR) - IRROverRun), max = max(RawIRR) + IRROverRun), nrow = 6)\n\n# Kill diagonal\ndiag(IncIRR) <- 0\n#make symetric\nIncIRR[lower.tri(IncIRR)] <- t(IncIRR)[lower.tri(IncIRR)]\nIncIRR <- as.data.frame(IncIRR)\nnames(IncIRR) <- c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\")\nrow.names(IncIRR) <- c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\")\n\n## Generate MARRS for the questions\nsort(RawIRR)\nMARRS <- sample(c(min(RawIRR - .01), mean(sort(RawIRR)[1:2]), mean(sort(RawIRR)[2:3]),   mean(sort(RawIRR)[4:5]) ), 4)\n\n## QUESTION/ANSWER GENERATION\n\n#Finds acceptable assets for each MARR and returns letter names\nAcceptable <- function(marr) {\n  c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\")[RawIRR >= marr]\n}\n\n#Acceptable(.2)\n\n# Ranks the assets from lowest to highest initial cost\nAOOrder <- function(){\n  c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\")[order(AO)]\n}\n\n#AOOrder()\n\n#Assume from asset1 to asset2 is an investment and not a loan.  Arguments are both characters.\nChallengerWins <- function(marr, asset1, asset2){\n  IncIRR[asset1, asset2] >= marr  \n}\n\n#ChallengerWins(.35, \"A\",\"C\")\n\n##\n##\n\nBestAsset <- function(marr){\nLetterOrder <- c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\")[order(AO)]\nLetterAcceptable <- c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\")[RawIRR >= marr]\n\nif ( length(LetterAcceptable) == 0) BC <- NA\nif ( length(LetterAcceptable) == 1) BC <- LetterAcceptable[1]\nif ( length(LetterAcceptable) > 1) {\n  TestOrder <- intersect(LetterOrder,LetterAcceptable)\n  \n  BC <- TestOrder[1]\n  for (Challenger in 2:length(TestOrder)) {\n    if (ChallengerWins(marr, BC, TestOrder[Challenger])) BC <- TestOrder[Challenger]\n  }\n}\n\nBC\n}\n\n# BestAsset(.1)\n\n```\n\nAll values in %.\n```{r results = \"asis\", message=FALSE, warning=FALSE}\n\nlibrary(knitr)\nkable(round(cbind(IRR, AO,  IncIRR*100),2))\n\n```\n\n\nStep 1:  Get the order of the assets right, lowest initial cost to highest `r paste(AOOrder(), collapse=\", \")`.\n\n\n## MARR = `r round(MARRS[1]*100,2)`\\%\n\n```{r results = \"asis\", message=FALSE, warning=FALSE}\n\nlibrary(knitr)\nkable(round(cbind(IRR, AO,  IncIRR*100),2))\n\n```\n\n## MARR = `r round(MARRS[1]*100,2)`\\%\n\n```{r results = \"asis\", message=FALSE, warning=FALSE}\n\nlibrary(knitr)\nkable(round(cbind(IRR, AO,  IncIRR*100),2))\n\n```\n\nThe acceptable assets are: `r paste(Acceptable(MARRS[1]),  collapse=\", \" )` and the best is `r BestAsset(MARRS[1])`.\n\n\n## MARR = `r round(MARRS[2]*100,2)`\\%\n\n```{r results = \"asis\", message=FALSE, warning=FALSE}\n\nlibrary(knitr)\nkable(round(cbind(IRR, AO,  IncIRR*100),2))\n\n```\n\n## MARR = `r round(MARRS[2]*100,2)`\\%\n\n```{r results = \"asis\", message=FALSE, warning=FALSE}\n\nlibrary(knitr)\nkable(round(cbind(IRR, AO,  IncIRR*100),2))\n\n```\n\nThe acceptable assets are: `r paste(Acceptable(MARRS[2]),  collapse=\", \" )` and the best is `r BestAsset(MARRS[2])`.\n\n\n## How to Study\n\n+ Worked Examples are at the bottom of this page. \n+ Examples ask you to\n    + Calculate IRR for simple asset.\n    + Calculate and apply AW criteria\n    + Apply PW criteria\n    + Use the IRR procedure",
    "created" : 1508882509276.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4032298285",
    "id" : "8D02EAD6",
    "lastKnownWriteTime" : 1503425484,
    "last_content_update" : 1503425484,
    "path" : "~/Teaching/PSU-EC314/Choice/InternalRateOfReturn.Rmd",
    "project_path" : "Choice/InternalRateOfReturn.Rmd",
    "properties" : {
        "ignored_words" : "beamer,IRRs,nsolve,geq,oopses,irr,Con't\n",
        "last_setup_crc32" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}